<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/common :: head('게시판')">

</head>
<body>
<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top" th:replace="fragments/common :: menu(board)">
</nav>

<div class="container">
    <h2>게시판</h2>
    <form action="#" th:action="@{/board/form}" th:object="${board}" method="post">
        <input type="hidden" th:field="*{id}">
        <div class="form-group">
            <label for="title">제목</label>
            <input type="text" class="form-control"
                   th:classappend="${#fields.hasErrors('title')}? 'is-invalid'" id="title" th:field="*{title}">
            <div class="invalid-feedback" th:if="${#fields.hasErrors('title')}" th:errors="*{title}">
                제목이 형식과 다름
            </div>
        </div>
        <div class="form-group">
            <label for="summernote">내용</label>
            <textarea id="summernote" name="editordata" th:field="*{content}"></textarea>
        </div>
        <div class="text-right">
            <a type="button" class="btn btn-primary" th:href="@{/board/list}">취소</a>
            <button type="submit" class="btn btn-primary">확인</button>
        </div>
    </form>
</div>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<link href="/summernote-0.8.18-dist/summernote-lite.css" rel="stylesheet">
<script src="/summernote-0.8.18-dist/summernote-lite.js"></script>
<script src="/summernote-0.8.18-dist/lang/summernote-ko-KR.js"></script>
<script>
	var setting = {
            height : 300,
            lang : 'ko-KR',
            callbacks : {	//여기 부분이 이미지를 첨부하는 부분
					onImageUpload : function(files) {
						for (var i = files.length - 1; i >= 0; i--) {
                            uploadSummernoteImageFile(files[i],
                            this);
                        }
					},
					onPaste: function (e) {
						var clipboardData = e.originalEvent.clipboardData;
						if (clipboardData && clipboardData.items && clipboardData.items.length) {
							var item = clipboardData.items[0];
							if (item.kind === 'file' && item.type.indexOf('image/') !== -1) {
								e.preventDefault();
							}
						}
					}
            }

    };
    $('#summernote').summernote(setting);

    function uploadSummernoteImageFile(file, editor) {
        data = new FormData();
        data.append("file", file);
        $.ajax({
            data : data,
            type : "POST",
            url : "/uploadSummernoteImageFile",
            contentType : false,
            enctype : 'multipart/form-data',
            processData : false,
            success : function(data) {
                $(editor).summernote('insertImage', data.url);
            }
        });
    }
</script>
<!--  -->
</body>
</html>